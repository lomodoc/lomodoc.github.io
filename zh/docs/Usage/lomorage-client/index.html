<!doctype html><html lang=zh dir=ltr><head><meta name=generator content="Hugo 0.78.1"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="命令行工具#命令行工具可以帮助高级用户做更多的控制使用，缺省安装目录是/opt/lomorage/bin/lomoc
重置用户的主目录和备份目录#当新用户通过手机创建成功以后，如果需要更改主目录或者备份目录，用户可以通过lomoc import的方式重置这些目录。重置前，请先把该用户已有的主目录和备份目录里面的所有内容拷贝到新的目录下。举例来说，如果新目录是/media/newdisk，有两个用户alice和bob需要重置，新目录的树结构应该是如下图所示
/media/newdisk/|-- alice| `-- Photos| |-- master| | |-- 2003| | | |-- 01| | | | `-- 17| | | | `-- 20030117_4.jpg| | | `-- 11| | | |-- 01| | | | |-- 20031101_2.jpg| | | | `-- 20031101_3.jpg| | | `-- 23| | | |-- 20031123_1."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="命令行工具"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://docs.lomorage.com/zh/docs/Usage/lomorage-client/"><meta property="og:site_name" content="Lomorage文档"><title>命令行工具 | Lomorage文档</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=alternate hreflang=en href=https://docs.lomorage.com/docs/Usage/lomorage-client/ title="Lomorage Command Line Client"><link rel=stylesheet href=/book.min.d805fe2ebdefe4129affdf99919216bbf7f9e3d6ed05e1b743c4e4266ceb6543.css integrity="sha256-2AX+Lr3v5BKa/9+ZkZIWu/f549btBeG3Q8TkJmzrZUM="><script defer src=/zh.search.min.00891b1c2882674d387851d093ff5a5d4ee3a0009f4220bc26fa418e0e71761f.js integrity="sha256-AIkbHCiCZ004eFHQk/9aXU7joACfQiC8JvpBjg5xdh8="></script><script defer src=/sw.min.74a8bb07f0bee86d6bb9a2750f073f14d93c7e4512f28860370cfd879e9719b4.js integrity="sha256-dKi7B/C+6G1ruaJ1Dwc/FNk8fkUS8ohgNwz9h56XGbQ="></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-138235951-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><link rel=alternate type=application/rss+xml href=https://docs.lomorage.com/zh/docs/Usage/lomorage-client/index.xml title=Lomorage文档></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a href=/zh><span>Lomorage文档</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=搜索 aria-label=搜索 maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><a href=https://docs.lomorage.com/zh/docs/Highlight/>功能</a><ul></ul></li><li class=book-section-flat><a href=https://docs.lomorage.com/zh/docs/Installation/>安装</a><ul><li><a href=https://docs.lomorage.com/zh/docs/Installation/lomorage-service/>Lomorage照片助手</a><ul><li><a href=https://docs.lomorage.com/zh/docs/Installation/lomorage-service/installation-raspbian/>Raspbian</a></li><li><a href=https://docs.lomorage.com/zh/docs/Installation/lomorage-service/installation-armbian/>Armbian</a></li><li><a href=https://docs.lomorage.com/zh/docs/Installation/lomorage-service/installation-ubuntu/>Ubuntu</a></li><li><a href=https://docs.lomorage.com/zh/docs/Installation/lomorage-service/installation-win/>Windows</a></li><li><a href=https://docs.lomorage.com/zh/docs/Installation/lomorage-service/installation-osx/>OSX</a></li><li><a href=https://docs.lomorage.com/zh/docs/Installation/lomorage-service/installation-docker/>Docker</a></li><li><a href=https://docs.lomorage.com/zh/docs/Installation/lomorage-service/installation-openwrt/>Openwrt</a></li><li><a href=https://docs.lomorage.com/zh/docs/Installation/lomorage-service/installation-unraid/>Unraid</a></li><li><a href=https://docs.lomorage.com/zh/docs/Installation/lomorage-service/installation-synology/>群晖</a></li></ul></li><li><a href=https://docs.lomorage.com/zh/docs/Installation/lomorage-client/>Lomorage客户端</a><ul><li><a href=https://docs.lomorage.com/zh/docs/Installation/lomorage-client/installation-ios/>iOS</a></li><li><a href=https://docs.lomorage.com/zh/docs/Installation/lomorage-client/installation-android/>Andriod</a></li><li><a href=https://docs.lomorage.com/zh/docs/Installation/lomorage-client/installation-web/>Web</a></li></ul></li><li><a href=https://docs.lomorage.com/zh/docs/Installation/lomo-frame/>Lomorage相框</a><ul></ul></li><li class=book-section-flat><a href=https://docs.lomorage.com/zh/docs/Installation/lomorage-importer/>导入工具</a><ul></ul></li></ul></li><li class=book-section-flat><a href=https://docs.lomorage.com/zh/docs/Usage/>使用说明</a><ul><li><a href=https://docs.lomorage.com/zh/docs/Usage/lomorage-client/ class=active>命令行工具</a><ul></ul></li><li><a href=https://docs.lomorage.com/zh/docs/Usage/Update/>手工升级Lomoarge后台系统</a><ul></ul></li><li><a href=https://docs.lomorage.com/zh/docs/Usage/external-access/>外网访问</a><ul></ul></li><li><a href=https://docs.lomorage.com/zh/docs/Usage/customized-view/>自定义视图</a><ul></ul></li></ul></li><li class=book-section-flat><a href=https://docs.lomorage.com/zh/docs/Roadmap/>产品路线图</a><ul></ul></li></ul><ul><li><a href=https://github.com/lomorage/homepage target=_blank rel=noopener>Github</a></li><li><a href=https://lomorage.com target=_blank rel=noopener>主页</a></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>命令行工具</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#命令行工具>命令行工具</a><ul><li><a href=#重置用户的主目录和备份目录>重置用户的主目录和备份目录</a></li><li><a href=#从已有目录中导入媒体文件>从已有目录中导入媒体文件</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=命令行工具>命令行工具
<a class=anchor href=#%e5%91%bd%e4%bb%a4%e8%a1%8c%e5%b7%a5%e5%85%b7>#</a></h1><p>命令行工具可以帮助高级用户做更多的控制使用，缺省安装目录是<code>/opt/lomorage/bin/lomoc</code></p><h2 id=重置用户的主目录和备份目录>重置用户的主目录和备份目录
<a class=anchor href=#%e9%87%8d%e7%bd%ae%e7%94%a8%e6%88%b7%e7%9a%84%e4%b8%bb%e7%9b%ae%e5%bd%95%e5%92%8c%e5%a4%87%e4%bb%bd%e7%9b%ae%e5%bd%95>#</a></h2><p>当新用户通过手机创建成功以后，如果需要更改主目录或者备份目录，用户可以通过<code>lomoc import</code>的方式重置这些目录。重置前，请先把该用户已有的主目录和备份目录里面的所有内容拷贝到新的目录下。举例来说，如果新目录是<code>/media/newdisk</code>，有两个用户<code>alice</code>和<code>bob</code>需要重置，新目录的树结构应该是如下图所示</p><pre><code>/media/newdisk/
|-- alice
|   `-- Photos
|       |-- master
|       |   |-- 2003
|       |   |   |-- 01
|       |   |   |   `-- 17
|       |   |   |       `-- 20030117_4.jpg
|       |   |   `-- 11
|       |   |       |-- 01
|       |   |       |   |-- 20031101_2.jpg
|       |   |       |   `-- 20031101_3.jpg
|       |   |       `-- 23
|       |   |           |-- 20031123_1.jpg
|       |   |           |-- 20031123_11.webp
|       |   |           |-- 20031123_12.dng
|       |   |           `-- 20031123_13.heic
|       |   |-- 2004
|       |   |   `-- 01
|       |   |       `-- 21
|       |   |           `-- 20040121_5.jpg
|       |   `-- 2013
|       |       |-- 07
|       |       |   `-- 28
|       |       |       `-- 20130728_7.png
`-- bob
    `-- Photos
        |-- master
        |   `-- 2013
        |       |-- 08
        |       |   `-- 08
        |       |       `-- 20130808_6.mp4
        |       `-- 11
        |           `-- 23
        |               |-- 20131123_10.zip
        |               |-- 20131123_10_image.heic
        |               |-- 20131123_8.zip
        |               |-- 20131123_8_image.jpg
        |               `-- 20131123_9.heic
</code></pre><p>注意:</p><ul><li>如果输入命令时指定用户名，则只会改变指定用户的主目录或者备份目录；如果没有指定用户，就会更新所有用户的主目录或者备份目录</li><li>缺省情况下，用户数据库位于<code>/opt/lomorage/var/assets.db</code>。如果安装过程中有更改，请使用<code>--db</code>选项来指定实际数据库位置</li></ul><pre><code>$ /opt/lomorage/bin/lomoc reset home-dir -h
NAME:
   lomoc reset home-dir - reset users' home directory in DB, and input dir must be media dir. If username is not specified, it will reset all users' home directory

USAGE:
   lomoc reset home-dir [command options] [new media dir] ([user name])

OPTIONS:
   --db value  db filename with full path (default: &quot;/opt/lomorage/var/assets.db&quot;)

$ /opt/lomorage/bin/lomoc reset backup-dir -h
NAME:
   lomoc reset backup-dir - reset users' backup directory in DB, and input dir must be media backup dir. If username is not specified, it will reset all users' backup directory

USAGE:
   lomoc reset backup-dir [command options] [new backup dir] ([user name])

OPTIONS:
   --db value  db filename with full path (default: &quot;/opt/lomorage/var/assets.db&quot;)

</code></pre><h2 id=从已有目录中导入媒体文件>从已有目录中导入媒体文件
<a class=anchor href=#%e4%bb%8e%e5%b7%b2%e6%9c%89%e7%9b%ae%e5%bd%95%e4%b8%ad%e5%af%bc%e5%85%a5%e5%aa%92%e4%bd%93%e6%96%87%e4%bb%b6>#</a></h2><p>如果用户有一些媒体文件存储在已有的USB硬盘或者本地磁盘，或者远程mount的磁盘，并且希望可以直接导入到本系统里面，除了使用importer tool，也可以使用lomoc来完成，这样可以避免额外的网络流量。缺省情况下，lomoc会删除旧文件，移动到新目录下，但是如果用户指定<code>--no-move</code>选项，则旧文件会仍然保留在已有的目录中，&ldquo;Lomorage照片助手"不会做任何操作。所有的导入日志存储在<code>/opt/lomorage/var/log/import_[import directory].log</code>里面。</p><p><strong>需要注意的是import导入会根据目录结构自动的创建相册</strong></p><pre><code>$ /opt/lomorage/bin/lomoc import -h
NAME:
   lomoc import - Import all photos from given directory into lomo backend with given username and password

USAGE:
   lomoc import [command options] [username] [password] [directory]

OPTIONS:
   --port value, -p value  (default: 8000)
   --no-move, -n           not moving original photos/videos, and only insert record in db
   --no-video, --nv        not scan video files. This is to speed up the first import process
</code></pre><p>需要注意事项:</p><ul><li>缺省情况下，lomod在端口8000监听，如果用户改变了监听端口，需要设置<code>--port</code>来指定新的监听端口`。</li><li>缺省情况下，导入会删除旧文件，移动到新目录下，但是如果用户指定<code>--no-move</code>选项，则旧文件会仍然保留在已有的目录中，&ldquo;Lomorage照片助手"不会做任何操作。</li><li>缺省情况下，后台会导入图片和视频文件，由于视频文件的缩略图生成比较耗时，用户可以选择<code>--no-video</code>选项来忽略视频文件导入。由于每次导入后台会检查文件SHA，所以用户可以在第一次导入成功以后，再一次扫描并且导入视频文件。</li></ul><p>导入日志范例:</p><pre><code>$ /opt/lomorage/bin/lomoc import alice password /media/STEC_838C-1111/test/video
-m
Login localhost successfully
import photos/videos from /media/STEC_838C-1111/test
please check import log /opt/lomorage/var/log/import_media_STEC_838C-1111_test.log

$ cat /opt/lomorage/var/log/import_media_STEC_838C-1111_test.log
start import /media/STEC_838C-1111/test/img/11_2014_01_21.webp
finish import /media/STEC_838C-1111/test/img/11_2014_01_21.webp to /media/STEC_838C-1111/alice/Photos/master/2021/09/20/20210920_9391.webp
start import /media/STEC_838C-1111/test/img/12_2014_01_21.heic
finish import /media/STEC_838C-1111/test/img/12_2014_01_21.heic to /media/STEC_838C-1111/alice/Photos/master/2021/09/20/20210920_9392.heic
start import /media/STEC_838C-1111/test/img/14_2017_09_13.heic
finish import /media/STEC_838C-1111/test/img/14_2017_09_13.heic to /media/STEC_838C-1111/alice/Photos/master/2017/09/13/20170913_9393.heic
start import /media/STEC_838C-1111/test/img/1_2003_01_17.jpg
finish import /media/STEC_838C-1111/test/img/1_2003_01_17.jpg to /media/STEC_838C-1111/alice/Photos/master/2003/01/17/20030117_9394.jpg
start import /media/STEC_838C-1111/test/img/3_2003_11_01.jpg
finish import /media/STEC_838C-1111/test/img/3_2003_11_01.jpg to /media/STEC_838C-1111/alice/Photos/master/2003/11/01/20031101_9395.jpg
start import /media/STEC_838C-1111/test/img/4_2003_11_01.jpg
finish import /media/STEC_838C-1111/test/img/4_2003_11_01.jpg to /media/STEC_838C-1111/alice/Photos/master/2003/11/01/20031101_9396.jpg
start import /media/STEC_838C-1111/test/img/5_2003_11_23.jpg
finish import /media/STEC_838C-1111/test/img/5_2003_11_23.jpg to /media/STEC_838C-1111/alice/Photos/master/2003/11/23/20031123_9397.jpg
start import /media/STEC_838C-1111/test/img/6_2004_01_21.jpg
finish import /media/STEC_838C-1111/test/img/6_2004_01_21.jpg to /media/STEC_838C-1111/alice/Photos/master/2004/01/21/20040121_9398.jpg
start import /media/STEC_838C-1111/test/img/7_2004_09_12.webp
finish import /media/STEC_838C-1111/test/img/7_2004_09_12.webp to /media/STEC_838C-1111/alice/Photos/master/2004/09/12/20040912_9399.webp
start import /media/STEC_838C-1111/test/img/8_2008_12_14.dng
finish import /media/STEC_838C-1111/test/img/8_2008_12_14.dng to /media/STEC_838C-1111/alice/Photos/master/2008/12/14/20081214_9400.dng
start import /media/STEC_838C-1111/test/img/9_2013_07_28.png
finish import /media/STEC_838C-1111/test/img/9_2013_07_28.png to /media/STEC_838C-1111/alice/Photos/master/2021/09/20/20210920_9401.png
start import /media/STEC_838C-1111/test/img/preview.jpg
finish import /media/STEC_838C-1111/test/img/preview.jpg to /media/STEC_838C-1111/alice/Photos/master/2003/11/23/20031123_9402.jpg
FINISH: totally scanned 1 directories, and imported 12 media files
</code></pre></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div class=book-languages tabindex=0 aria-haspopup=true><ul><li class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
中文</li></ul><ul class=book-languages-list><li><a href=https://docs.lomorage.com/docs/Usage/lomorage-client/ class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
English</a></li><li class=active><a href=https://docs.lomorage.com/zh/ class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
中文</a></li></ul></div><div><a class="flex align-center" href=https://github.com/lomodoc/homepage/commit/98542bff03a7aefb33776876e49d5eff55c67cf4 title="最后修改者 Dweb Fan | October 1, 2022" target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>October 1, 2022</span></a></div><div><a class="flex align-center" href=https://github.com/lomodoc/homepage/edit/main/content.zh/docs/Usage/lomorage-client/_index.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>编辑本页</span></a></div></div></footer><div class=book-comments><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"lomorage"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#命令行工具>命令行工具</a><ul><li><a href=#重置用户的主目录和备份目录>重置用户的主目录和备份目录</a></li><li><a href=#从已有目录中导入媒体文件>从已有目录中导入媒体文件</a></li></ul></li></ul></nav></div></aside></main></body></html>